@using CSM.Bataan.School.WebSite.Infrastructure.Data.BusinessObjects;
@using CSM.Bataan.School.WebSite.Infrastructure.Data.Enums;
@model CSM.Bataan.School.WebSite.ViewModels.News.IndexViewModel
@{
    Layout = "~/views/shared/_layout.cshtml";
}

<div class="divider"></div>

<div class="content">
    <div class="container">

        <div class="main-content">
            <h1>News Feed</h1>
            <section class="posts-con" id="news">
                @{
                    if (Model.News != null)
                    {
                        if (Model.News.Count > 0)
                        {
                            foreach (NewsFeedItem item in Model.News)
                            {
                                <article>
                                    <div class="current-date">
                                        <p>@item.Timestamp.ToString("MMMM")</p>
                                        <p class="date">@item.Timestamp.Day</p>
                                    </div>
                                    <div class="info">
                                        <img src="~/images/news/@item.Id/@Guid.NewGuid()/banner.png" alt="@item.Title" />
                                        <h4><strong>@item.Title</strong></h4>
                                        <p class="info-line">@item.UserName</p>
                                        <p>@item.Description</p>
                                        <a class="more" href="~/news/@item.Id">Read more</a>
                                    </div>
                                </article>
                            }
                        }
                    }
                    else
                    {
                        <article>
                            <div class="current-date">
                                <p>@DateTime.UtcNow.Month</p>
                                <p class="date">@DateTime.UtcNow.Day</p>
                            </div>
                            <div class="info">
                                <h3>No Results Yet</h3>
                            </div>
                        </article>
                    }
                }
            </section>
            <div class="col-lg-12">
                <div class="table-responsive table--no-card m-b-30">
                    <a href="#" onclick="return getFeed();" class="btn btn-lg btn-info btn-block">
                        <i class="fa fa-plus"></i>&nbsp;
                        <span>More</span>
                    </a>
                </div>
            </div>
        </div>

        <aside id="sidebar">
            <div class="widget clearfix calendar">
                <h2>Event calendar</h2>
                <div class="head">
                    <a class="prev" href="#"></a>
                    <a class="next" href="#"></a>
                    <h4>April 2014</h4>
                </div>
                <div class="table">
                    <table>
                        <tr>
                            <th class="col-1">Mon</th>
                            <th class="col-2">Tue</th>
                            <th class="col-3">Wed</th>
                            <th class="col-4">Thu</th>
                            <th class="col-5">Fri</th>
                            <th class="col-6">Sat</th>
                            <th class="col-7">Sun</th>
                        </tr>
                        <tr>
                            <td class="col-1 disable"><div>31</div></td>
                            <td class="col-2"><div>1</div></td>
                            <td class="col-3"><div>2</div></td>
                            <td class="col-4"><div>3</div></td>
                            <td class="col-5 archival"><div>4</div></td>
                            <td class="col-6"><div>5</div></td>
                            <td class="col-7"><div>6</div></td>
                        </tr>
                        <tr>
                            <td class="col-1"><div>7</div></td>
                            <td class="col-2"><div>8</div></td>
                            <td class="col-3 archival"><div>9</div></td>
                            <td class="col-4"><div>10</div></td>
                            <td class="col-5"><div>11</div></td>
                            <td class="col-6"><div>12</div></td>
                            <td class="col-7"><div>13</div></td>
                        </tr>
                        <tr>
                            <td class="col-1"><div>14</div></td>
                            <td class="col-2 upcoming">
                                <div>
                                    <div class="tooltip">
                                        <div class="holder">
                                            <h4>Omnis iste natus error sit voluptatem dolor</h4>
                                            <p class="info-line"><span class="time">10:30 AM</span><span class="place">Lincoln High School</span></p>
                                            <p>At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident similique.</p>
                                        </div>
                                    </div>15
                                </div>
                            </td>
                            <td class="col-3"><div>16</div></td>
                            <td class="col-4 upcoming">
                                <div>
                                    <div class="tooltip">
                                        <div class="holder">
                                            <h4>Omnis iste natus error sit voluptatem dolor</h4>
                                            <p class="info-line"><span class="time">10:30 AM</span><span class="place">Lincoln High School</span></p>
                                            <p>At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident similique.</p>
                                        </div>
                                    </div>16
                                </div>
                            </td>
                            <td class="col-5"><div>18</div></td>
                            <td class="col-6"><div>19</div></td>
                            <td class="col-7"><div>20</div></td>
                        </tr>
                        <tr>
                            <td class="col-1"><div>21</div></td>
                            <td class="col-2"><div>22</div></td>
                            <td class="col-3"><div>23</div></td>
                            <td class="col-4"><div>24</div></td>
                            <td class="col-5 upcoming">
                                <div>
                                    <div class="tooltip">
                                        <div class="holder">
                                            <h4>Omnis iste natus error sit voluptatem dolor</h4>
                                            <p class="info-line"><span class="time">10:30 AM</span><span class="place">Lincoln High School</span></p>
                                            <p>At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident similique.</p>
                                        </div>
                                    </div>25
                                </div>
                            </td>
                            <td class="col-6"><div>26</div></td>
                            <td class="col-7"><div>27</div></td>
                        </tr>
                        <tr>
                            <td class="col-1"><div>28</div></td>
                            <td class="col-2 upcoming">
                                <div>
                                    <div class="tooltip">
                                        <div class="holder">
                                            <h4>Omnis iste natus error sit voluptatem dolor</h4>
                                            <p class="info-line"><span class="time">10:30 AM</span><span class="place">Lincoln High School</span></p>
                                            <p>At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident similique.</p>
                                        </div>
                                    </div>29
                                </div>
                            </td>
                            <td class="col-3"><div>30</div></td>
                            <td class="col-4 disable"><div>1</div></td>
                            <td class="col-5 disable"><div>2</div></td>
                            <td class="col-6 disable"><div>3</div></td>
                            <td class="col-7 disable"><div>4</div></td>
                        </tr>
                    </table>
                </div>
                <div class="note">
                    <p class="upcoming-note">Upcoming event</p>
                    <p class="archival-note">Archival event</p>
                </div>
            </div>
            <div class="widget list">
                <h2>Photo gallery</h2>
                <ul>
                    <li><a href="#"><img src="images/4.png" alt=""></a></li>
                    <li><a href="#"><img src="images/4_2.png" alt=""></a></li>
                    <li><a href="#"><img src="images/4_3.png" alt=""></a></li>
                    <li><a href="#"><img src="images/4_4.png" alt=""></a></li>
                    <li><a href="#"><img src="images/4_5.png" alt=""></a></li>
                    <li><a href="#"><img src="images/4_6.png" alt=""></a></li>
                </ul>
                <div class="btn-holder">
                    <a class="btn blue" href="#">Show more photos</a>
                </div>
            </div>
        </aside>
        <!-- / sidebar -->

    </div>
    <!-- / container -->
</div>

@section pageStyles{
    <style>
        .info-group-line {
            font-size: small;
            font-weight: bold;
            margin-right: 17px;
        }
    </style>
}

@section pageScripts{
    <script src="~/js/date_format.js"></script>
    <script>
    var page = @("1");
    var calling = false;
    function getFeed() {
        $.ajax({
            type: "GET",
            url: "/news/feed/" + (page + 1),
            success: function (rsp) {
                page = page + 1;
                $.each(rsp, function (index, item) {
                    var itemTimestamp = new Date(Date.parse(item.timestamp));
                    var markup = "<article>";
                    markup = markup + "<div class='current-date'>";
                    markup = markup + "<p>" + itemTimestamp.format("mmmm") + "</p>";
                    markup = markup + "<p class='date'>" + itemTimestamp.format("d") + "</p>";
                    markup = markup + "</div>";
                    markup = markup + "<div class='info'>";
                    markup = markup + "<img src='/images/news/" + item.id +"/@Guid.NewGuid()/banner.png' alt='" + item.title + "' />";
                    markup = markup + "<h4><strong>" + item.title + "</strong></h4>";
                    markup = markup + "<p class='info-line'>" + item.userName + "</p>";
                    markup = markup + "<p>" + item.description + "</p>";
                    markup = markup + "<a class='more' href='~/news/" + item.id + "'>Read more</a>";
                    markup = markup + "</div>";
                    markup = markup + "</article>";
                    $("#news").append(markup);
                });
            }
        });
        return false;
    };
    </script>
}